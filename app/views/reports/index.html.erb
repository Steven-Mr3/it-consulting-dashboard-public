<div class="p-8">
  <h1 class="text-3xl font-bold text-[#c9d1d9] mb-8">Reports</h1>

  <div class="bg-[#161b22] border border-[#30363d] rounded-lg p-6 mb-6">
    <%= form_with url: reports_path, method: :get, class: "grid grid-cols-1 md:grid-cols-4 gap-4" do |f| %>
      <%= f.date_field :start_date, value: @start_date, class: "px-4 py-2 bg-[#0d1117] border border-[#30363d] rounded-lg text-[#c9d1d9] focus:border-[#58a6ff] focus:outline-none" %>
      <%= f.date_field :end_date, value: @end_date, class: "px-4 py-2 bg-[#0d1117] border border-[#30363d] rounded-lg text-[#c9d1d9] focus:border-[#58a6ff] focus:outline-none" %>
      <%= f.select :client_id, options_for_select([['All Clients', '']] + @clients.map { |c| [c.name, c.id] }, params[:client_id]), {}, class: "px-4 py-2 bg-[#0d1117] border border-[#30363d] rounded-lg text-[#c9d1d9] focus:border-[#58a6ff] focus:outline-none" %>
      <%= f.submit "Generate Report", class: "px-4 py-2 bg-[#58a6ff] text-white rounded-lg hover:bg-[#58a6ff]/80 cursor-pointer" %>
    <% end %>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
    <div class="bg-[#161b22] border border-[#30363d] rounded-lg p-6">
      <h3 class="text-sm font-medium text-[#8b949e] mb-1">Total Tickets</h3>
      <p class="text-3xl font-bold text-[#c9d1d9]"><%= @total_tickets %></p>
    </div>
    <div class="bg-[#161b22] border border-[#30363d] rounded-lg p-6">
      <h3 class="text-sm font-medium text-[#8b949e] mb-1">Resolved</h3>
      <p class="text-3xl font-bold text-[#7ee787]"><%= @resolved_tickets %></p>
    </div>
    <div class="bg-[#161b22] border border-[#30363d] rounded-lg p-6">
      <h3 class="text-sm font-medium text-[#8b949e] mb-1">SLA Compliance</h3>
      <p class="text-3xl font-bold text-[#c9d1d9]"><%= @sla_compliance %>%</p>
    </div>
    <div class="bg-[#161b22] border border-[#30363d] rounded-lg p-6">
      <h3 class="text-sm font-medium text-[#8b949e] mb-1">Avg Resolution</h3>
      <p class="text-3xl font-bold text-[#c9d1d9]"><%= @average_resolution_time %>h</p>
    </div>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <div class="bg-[#161b22] border border-[#30363d] rounded-lg p-6">
      <h3 class="text-lg font-semibold text-[#c9d1d9] mb-4">Tickets by Status</h3>
      <canvas id="reportStatusChart"></canvas>
    </div>
    <div class="bg-[#161b22] border border-[#30363d] rounded-lg p-6">
      <h3 class="text-lg font-semibold text-[#c9d1d9] mb-4">Tickets Over Time</h3>
      <canvas id="reportTrendChart"></canvas>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    new Chart(document.getElementById('reportStatusChart'), {
      type: 'pie',
      data: {
        labels: <%= raw @tickets_by_status.keys.map(&:titleize).to_json %>,
        datasets: [{
          data: <%= raw @tickets_by_status.values.to_json %>,
          backgroundColor: ['#58a6ff', '#ffa657', '#7ee787', '#8b949e']
        }]
      },
      options: { plugins: { legend: { labels: { color: '#c9d1d9' } } } }
    });

    new Chart(document.getElementById('reportTrendChart'), {
      type: 'line',
      data: {
        labels: <%= raw @tickets_over_time.keys.map(&:to_s).to_json %>,
        datasets: [{
          label: 'Tickets',
          data: <%= raw @tickets_over_time.values.to_json %>,
          borderColor: '#58a6ff',
          backgroundColor: 'rgba(88, 166, 255, 0.1)',
          tension: 0.4,
          fill: true
        }]
      },
      options: {
        scales: {
          x: { ticks: { color: '#8b949e' }, grid: { color: '#30363d' } },
          y: { ticks: { color: '#8b949e' }, grid: { color: '#30363d' } }
        },
        plugins: { legend: { labels: { color: '#c9d1d9' } } }
      }
    });
  });
</script>
